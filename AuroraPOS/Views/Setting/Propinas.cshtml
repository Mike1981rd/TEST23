@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<div class="container-xxl flex-grow-1 container-p-y">
    <div class="row g-6">

        @* Render el menu interno *@
        @Html.Partial("InternalMenu.cshtml", 8)

        <!-- Options -->
        <div class="col-12 col-lg-8 pt-6 pt-lg-0">
            <div class="page-header">
                <div class="page-title">
                    <h4>@ViewLocalizer["Propina Rates"]</h4>
                    <h6>@ViewLocalizer["Manage Propina Rates"]</h6>
                </div>
                <div class="page-btn">
                    <a id="add-propina" class="btn btn-added"><img src="~/vendor/img/icons/plus.svg" alt="img" class="me-1">@ViewLocalizer["Add New Propina"]</a>
                </div>
            </div>
            <!-- /product list -->
            <div class="card">
                <div class="card-body">

                    <div class="table-responsive">
                        <table id="propina-list" class="table">
                            <thead>
                                <tr>
                                    <th>@ViewLocalizer["Action"]</th>
                                    <th>@ViewLocalizer["Propina Name"]</th>
                                    <th>@ViewLocalizer["Propina (%)"]</th>
                                    <th>@ViewLocalizer["To go exclude"]</th>
                                    <th>@ViewLocalizer["Barcode exclude"]</th>
                                    <th>@ViewLocalizer["Status"]</th>

                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>

            <!-- edit Modal -->
            <div class="modal fade" id="editpropina" tabindex="-1" role="dialog" aria-hidden="true" data-id="">
                <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="propina-modal-title">@ViewLocalizer["Edit Propina"]</h5>
                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-12">
                                    <div class="form-group">
                                        <label>@ViewLocalizer["Propina Name"]<span class="manitory">*</span></label>
                                        <input id="epropina-name" type="text" value="SGST 4.5%	" required>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label>@ViewLocalizer["Propina (%)"]<span class="manitory">*</span></label>
                                        <input id="epropina-value" type="text" value="4.50" required>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-sm-6 col-12">
                                    <div class="form-group row">
                                        <input id="epropina-article" type="checkbox" class="col-sm-4 col-4">
                                        <label class="col-sm-8 col-8">@ViewLocalizer["Article"]  </label>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-sm-6 col-12">
                                    <div class="form-group row">
                                        <input id="epropina-shipping" type="checkbox" class="col-sm-4 col-4">
                                        <label class="col-sm-8 col-8">@ViewLocalizer["Sales"]  </label>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-sm-6 col-12">
                                    <div class="form-group row">
                                        <input id="epropina-togo" type="checkbox" class="col-sm-4 col-4">
                                        <label class="col-sm-8 col-8">@ViewLocalizer["To go exclude"]  </label>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-sm-6 col-12">
                                    <div class="form-group row">
                                        <input id="epropina-barcode" type="checkbox" class="col-sm-4 col-4">
                                        <label class="col-sm-8 col-8">@ViewLocalizer["Barcode exclude"]  </label>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-sm-6 col-12">
                                    <div class="form-group row">
                                        <input id="epropina-kiosk" type="checkbox" class="col-sm-4 col-4">
                                        <label class="col-sm-8 col-8">@ViewLocalizer["Kiosk exclude"]  </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group mb-0">
                                        <label>@ViewLocalizer["Status"]</label>
                                        <select id="epropina-status" class="select">
                                            <option value="1"> @ViewLocalizer["Active"]</option>
                                            <option value="0"> @ViewLocalizer["InActive"]</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row pt-5">
                                <div class="col-lg-12 col-sm-12 col-12">
                                    <div class="d-flex  align-items-center pb-4" style="gap: 5px;">
                                        <h6 class="text-left"> @ViewLocalizer["Accounting"]</h6>
                                        <div class="add-unit">
                                            <a class="add-accounting-item" href="javascript:void(0);">
                                                <img src="/vendor/img/icons/plus1.svg" alt="img">
                                            </a>
                                        </div>
                                    </div>
                                    <table class="table reordertable">
                                        <thead>
                                            <tr>
                                                <td>
                                                    @ViewLocalizer["Name"]
                                                </td>
                                                <td>
                                                    @ViewLocalizer["Type"]
                                                </td>
                                                <td>
                                                    @ViewLocalizer["Number"]
                                                </td>
                                                <td>
                                                    @ViewLocalizer["Action"]
                                                </td>
                                        </thead>
                                        <tbody id="accounting-list">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button id="edit-propina" type="button" class="btn btn-submit">@ViewLocalizer["Submit"]</button>
                            <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">@ViewLocalizer["Cancel"]</button>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            </div>
            </div>


@{
    @await Component.InvokeAsync("Accounting", new { })
}

<script>

    var propinatable = $("#propina-list").DataTable({
        "processing": true, // for show progress bar
        "serverSide": true, // for process server side
        "filter": true, // this is for disable filter (search box)
        "orderMulti": false, // for disable multiple column at once
        "ajax": {
            "url": "/Setting/GetPropinaList",
            "type": "POST",
            "datatype": "json"
        },
        'select': {
            'style': 'multi'
        },
        "pageLength": 10,
        "lengthMenu": [10, 25, 50],
        "order": [[1, 'asc']],
        "columns": [
            {
                'data': 'action', 'name': 'action',
                render: function (data, type, row) {
                    return "<a class='me-3' href='javascript:void(0);' onclick='Editpropina(" + JSON.stringify(row) + ")'><img src='/vendor/img/icons/edit.svg' alt='img'></a>";
                },
            },
            { "data": "propinaName", "name": "propinaName", "autoWidth": true },
            { "data": "propinaValue", "name": "propinaValue", "autoWidth": true },
            { "data": "isToGoExclude", "name": "isToGoExclude", "autoWidth": true },
            { "data": "isBarcodeExclude", "name": "isBarcodeExclude", "autoWidth": true },
            {
                'data': 'status', 'name': 'isActive',
                render: function (data, type, row) {
                    if (row.isActive) {
                        return "<span class='badges bg-lightgreen'>@ViewLocalizer["Active"]</span>";
                    }
                    else {
                        return "<span class='badges bg-lightred'>@ViewLocalizer["InActive"]</span>";
                    }
                },
                "autoWidth": true
            },
          
        ]
    });

    $("#add-propina").click(function () {
        Addpropina();
    });

    function Addpropina() {
        $("#epropina-name").val("");
        $("#epropina-value").val("");
        $("#epropina-status").val(1).change();
        $("#editpropina").data("id", 0);
        $(".propina-modal-title").html("@ViewLocalizer["Add propina"]");
        GetAccountItems(7, 0)
        $("#editpropina").modal("show");
    }

    function Editpropina(propina) {
        $("#epropina-name").val(propina.propinaName);
        $("#epropina-value").val(propina.propinaValue);
        if (propina.isActive) {
            $("#epropina-status").val(1).change();
        }
        else {
            $("#epropina-status").val(0).change();
        }
        if (propina.isInPurchaseOrder) {
            $("#epropina-porder").prop("checked", true);
        }
        else{
            $("#epropina-porder").prop("checked", false);
        }
        if (propina.isInArticle) {
            $("#epropina-article").prop("checked", true);
        }
        else{
            $("#epropina-article").prop("checked", false);
        }
        if (propina.isShipping) {
            $("#epropina-shipping").prop("checked", true);
        }
        else{
            $("#epropina-shipping").prop("checked", false);
        } 
        if (propina.isToGoExclude) {
            $("#epropina-togo").prop("checked", true);
        }
        else{
            $("#epropina-togo").prop("checked", false);
        }
        if (propina.isBarcodeExclude) {
            $("#epropina-barcode").prop("checked", true);
        }
        else {
            $("#epropina-barcode").prop("checked", false);
        }
        if (propina.isKioskExclude) {
            $("#epropina-kiosk").prop("checked", true);
        }
        else {
            $("#epropina-kiosk").prop("checked", false);
        }
        $(".propina-modal-title").html("@ViewLocalizer["Edit propina"]");
        GetAccountItems(7, propina.id)
        $("#editpropina").data("id", propina.id);
        $("#editpropina").modal("show");
    }

    $("#edit-propina").click(function () {
        var propinaName = $("#epropina-name").val();
        if (!propinaName || propinaName == "") {
            toastr.warning("@ViewLocalizer["Please input the propina name."]", { showMethod: "fadeIn", hideMethod: "fadeOut", timeOut: 2e3 })
            return;
        }
        var propinavalue = parseFloat($("#epropina-value").val());
        if (!propinavalue) propinavalue == 0;
        var active = $("#epropina-status").val()
        var data = {
            ID: $("#editpropina").data("id"),
            propinaName: propinaName,
            IsInPurchaseOrder: $("#epropina-porder").prop("checked"),
            IsInArticle: $("#epropina-article").prop("checked"),
            IsShipping: $("#epropina-shipping").prop("checked"),
            IsToGoExclude: $("#epropina-togo").prop("checked"),
            IsBarcodeExclude: $("#epropina-barcode").prop("checked"),
            IsKioskExclude: $("#epropina-kiosk").prop("checked"),
            propinaValue: propinavalue,
            IsActive: active == "1"
        }

        $.ajax({
            url: "/Setting/EditPropina",
            type: "POST",
            data: data,
            success: function (data, textStatus, jqXHR) {
                if (data.status == 0) {
                    SaveAccountItems(7, data.id, function () {
                        propinatable.draw();
                        $("#editpropina").modal("hide");
                    })
                 
                }
                else if (data.status == 2) {
                    toastr.error("@ViewLocalizer["The propina name should be unique."]", {})
                }
                else {
                    toastr.error("@ViewLocalizer["There was an error in processing the request."]", {})
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                toastr.error("@ViewLocalizer["There was an error in processing the request."]", {})
            }
        });
    });

    function Deletepropina(id) {

        Swal.fire({
            title: "@ViewLocalizer["Are you sure to delete the propina?"]",
            text: "",
            type: "warning",
            showCancelButton: !0,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "@ViewLocalizer["Yes, delete it!"]",
            cancelButtonText: "@ViewLocalizer["Cancel"]",
            confirmButtonClass: "btn btn-primary",
            cancelButtonClass: "btn btn-danger ml-1",
            buttonsStyling: !1,
        }).then(function (t) {
            if (t.value) {
                $.ajax({
                    url: "/Setting/Deletepropina?propinaId=" + id,
                    type: "POST",
                    success: function (data, textStatus, jqXHR) {
                        if (data.status == 0) {
                            propinatable.draw();
                        }
                        else {
                            toastr.error("@ViewLocalizer["Failed to delete the propina."]", {})
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        toastr.error("@ViewLocalizer["There was an error in processing the request."]", {})
                    }
                });
            }

        });

    }



</script>