@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<div class="content-wrapper">
    <!-- Content -->
    <div class="container-xxl flex-grow-1 container-p-y">
        <h4 class="mb-1">@ViewLocalizer["Role List"]</h4>

        <p class="mb-6">A role provided access to predefined menus and features so that depending on <br> assigned role an administrator can have access to what user needs.</p>
        <!-- Role cards -->
		<div class="row g-6" id="roles-container">
			<!-- Aquí se generarán dinámicamente las tarjetas de roles -->
		</div>
    </div>
        <!--/ Role cards -->
        <!-- Add Role Modal -->
        <!-- Add Role Modal -->
        <div class="modal fade" id="addRoleModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-simple modal-dialog-centered modal-add-new-role">
                <div class="modal-content">
                    <div class="modal-body">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        <div class="text-center mb-6">
                            <h4 class="role-title mb-2">Add New Role</h4>
                            <p>Set role permissions</p>
                        </div>
                        <!-- Add role form -->
                        <form id="addRoleForm" class="row g-6 fv-plugins-bootstrap5 fv-plugins-framework" onsubmit="return false" novalidate="novalidate">
                            <div class="col-12 fv-plugins-icon-container">
                                <label class="form-label" for="modalRoleName">Role Name</label>
                                <input type="text" id="modalRoleName" name="modalRoleName" class="form-control" placeholder="Enter a role name" tabindex="-1">
                                <div class="fv-plugins-message-container fv-plugins-message-container--enabled invalid-feedback"></div>
                            </div>
                            <div class="col-12">
                                <h5 class="mb-6">Role Permissions</h5>
                                <!-- Permission table -->
                                <div class="table-responsive">
                                   
                                </div>
                                <!-- Permission table -->
                            </div>
                            <div class="col-12 text-center">
                                <button type="submit" class="btn btn-primary me-3 waves-effect waves-light">Submit</button>
                                <button type="reset" class="btn btn-label-secondary waves-effect" data-bs-dismiss="modal" aria-label="Close">Cancel</button>
                            </div>
                            <input type="hidden">
                        </form>
                        <!--/ Add role form -->
                    </div>
                </div>
            </div>
        </div>
        <!--/ Add Role Modal -->
        <!-- / Add Role Modal -->
    </div>
    <!-- / Content -->
</div>

<script>
    $(document).ready(function () {
        // Llamada a la API para obtener roles para tarjetas
        $.ajax({
            url: "/Setting/GetRolesForCards", // Cambia aquí a la nueva función
            type: "POST",
            dataType: "json",
            success: function (response) {
                console.log(response); // Verifica la respuesta aquí
                var cardsHtml = '';

                // Verifica si hay datos en la respuesta
                if (response.data && response.data.length > 0) {
                    // Generar tarjetas con los datos recibidos
                    $.each(response.data, function (index, role) {
                        cardsHtml += `
                            <div class="col-xl-4 col-lg-6 col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-end mb-4">
                                            <h5 class="mb-1">${role.roleName}</h5>
                                            <span class="badge badge-primary">${role.priority}</span>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-end">
                                            <a href="/Setting/AddRole?roleId=${role.id}" class="btn btn-warning btn-sm">Edit Role</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    cardsHtml = '<p>No roles found.</p>';
                }

                // Insertar las tarjetas generadas en el contenedor
                $('#roles-container').html(cardsHtml);

                // Agregar la tarjeta "Add New Role" al final
                $('#roles-container').append(`
                    <div class="col-xl-4 col-lg-6 col-md-6">
                        <div class="card ">
   
                                    <div class="card-body text-sm-end text-center ">
                                                <button data-bs-target="#addRoleModal" data-bs-toggle="modal" class="btn btn-warning btn-smt">Add New Role</button>
                                        <p class="mb-0">Add new role, <br> if it doesn't exist.</p>
                                    </div>
                        </div>
                    </div>
                `);
            },
            error: function (xhr, status, error) {
                console.error("Error fetching roles:", error);
                $('#roles-container').html('<p>Error loading roles.</p>'); // Ajusta aquí
            }
        });

    });


   
</script>