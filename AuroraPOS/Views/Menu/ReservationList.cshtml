@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
	var stations = (List<Station>)ViewBag.Stations;
}

<div class="page-header">
	<div class="page-title">
		<h4>Reservaciones</h4>
		<h6>@ViewLocalizer["Manage your Reservaciones"]</h6>
	</div>
	<div class="page-btn">
	</div>
</div>


<!-- /product list -->
<div class="card">
	<div class="card-body">
		<div class="row">
			<div class="table-top">
				<div class="search-set">
					<div class="search-path">
						<a class="btn btn-filter" id="filter_search">
							<img src="/vendor/img/icons/filter.svg" alt="img">
							<span><img src="/vendor/img/icons/closes.svg" alt="img"></span>
						</a>
					</div>
					<div class="search-input">
						<a class="btn btn-searchset"><img src="/vendor/img/icons/search-white.svg" alt="img"></a>
						<div class="dataTables_filter"><label> <input id="filter-searchtext" type="search" class="form-control form-control-sm" placeholder="@ViewLocalizer["Search"]" ..."></label></div>
					</div>
				</div>
				<div class="wordset">
					<ul>
						<li>
							<a data-bs-toggle="tooltip" data-bs-placement="top" title="pdf"><img src="/vendor/img/icons/pdf.svg" alt="img"></a>
						</li>
						<li>
							<a data-bs-toggle="tooltip" data-bs-placement="top" title="excel"><img src="/vendor/img/icons/excel.svg" alt="img"></a>
						</li>
						<li>
							<a data-bs-toggle="tooltip" data-bs-placement="top" title="print"><img src="/vendor/img/icons/printer.svg" alt="img"></a>
						</li>
					</ul>
				</div>
			</div>
			<!-- /Filter -->
			<div class="card" id="filter_inputs">
				<div class="card-body pb-0">
					<div class="row">
						<div class="col-lg-3 col-sm-6 col-12">
							<div class="form-group">
								<label>@ViewLocalizer["Station"] </label>
								<select id="filter-station" class="select">
									<option value="">ALL</option>
									@foreach(var s in stations)
									{
										<option value="@s.ID">@s.Name</option>
									}
								</select>
							</div>
						</div>
						<div class="col-lg-3 col-sm-6 col-12">
							<div class="form-group">
								<label>@ViewLocalizer["Date From"] </label>
								<input id="filter_reservation_datefrom" type="text" class="datetimepicker cal-icon" value="@DateTime.Today.AddDays(-10).ToString("dd-MM-yyyy")" placeholder="@ViewLocalizer["Choose Date"]">
							</div>
						</div>
						<div class="col-lg-3 col-sm-6 col-12">
							<div class="form-group">
								<label>@ViewLocalizer["Date To"] </label>
								<input id="filter_reservation_dateto" type="text" class="datetimepicker cal-icon" value="@DateTime.Today.ToString("dd-MM-yyyy")" placeholder="@ViewLocalizer["Choose Date"]">
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="table-responsive">
				<table id="reservation-list" class="table">
					<thead>
						<tr>
							<th>@ViewLocalizer["Status"]</th>
							<th>@ViewLocalizer["Station"]</th>
							<th>@ViewLocalizer["Area"]</th>
							<th>@ViewLocalizer["Table"]</th>
							<th>@ViewLocalizer["Date"] </th>
							<th>@ViewLocalizer["Time"]</th>
							<th>@ViewLocalizer["Range(H)"]</th>
							<th>@ViewLocalizer["Name"]</th>
							<th>@ViewLocalizer["Phone"]</th>
							<th>@ViewLocalizer["Count"]</th>
							<th>@ViewLocalizer["Comment"]</th>
						</tr>
					</thead>
				</table>
			</div>
		</div>
	</div>
</div>
<!-- /product list -->

<script>
	$(document).ready(function () {


		$("#filter-searchtext").on("change keyup", function () {
			FilterReservation()
		});
		$("#filter-station").on("change", function () {
			FilterReservation()
		});

		$("#filter_search").click(function () {
			FilterReservation()
		});
	});

	var reservationtable = $("#reservation-list").DataTable({
		"processing": true, // for show progress bar
		"serverSide": true, // for process server side
		"dom": 'rt<"row"<"col-sm-3"l><"col-sm-6 s-txt"p><"col-sm-3 text-end"i>>',
		"orderMulti": false, // for disable multiple column at once
		"ajax": {
			"url": "/Menu/GetReservationList",
			"type": "POST",
			"datatype": "json"
		},
		'select': {
			'style': 'multi'
		},
		"pageLength": 10,
		"lengthMenu": [10, 25, 50],
		"order": [[1, 'asc']],
		"columns": [
			{
				'data': 'status', 'name': 'status',
				render: function (data, type, row) {
					if (row.status == 0) {
						return "<span class='badges bg-lightgreen'>@ViewLocalizer["Open"]</span>";
					}
					else if (row.status == 1) {
						return "<span class='badges bg-grey'>@ViewLocalizer["Done"]</span>";
					}
					else if (row.status == 2) {
						return "<span class='badges bg-lightred'>@ViewLocalizer["Canceled"]</span>";
					}
					else if (row.status == 3) {
						return "<span class='badges bg-lightgreen'>@ViewLocalizer["Arrived"]</span>";
					}
					else {
						return "";
					}
				},
				"autoWidth": true
			},
			{ "data": "stationName", "name": "stationName", "autoWidth": true },
			{ "data": "areaName", "name": "areaName", "autoWidth": true },
			{ "data": "tableName", "name": "tableName", "autoWidth": true },
			{ "data": "reservationDate", "name": "reservationDate", "autoWidth": true },
			{ "data": "reservationTime", "name": "reservationTime", "autoWidth": true },
			{ "data": "duration", "name": "duration", "autoWidth": true },
			{ "data": "guestName", "name": "guestName", "autoWidth": true },
			{ "data": "phoneNumber", "name": "phoneNumber", "autoWidth": true },
			{ "data": "guestCount", "name": "guestCount", "autoWidth": true },
			{ "data": "comments", "name": "comments", "autoWidth": true },
		]
	});


	function FilterReservation() {
		var searchText = $("#filter-searchtext").val();
		var station = $("#filter-station").val();
		if (!station) station = "";
		var from = $("#filter_reservation_datefrom").val();
		var to = $("#filter_reservation_dateto").val();

		reservationtable.columns(0).search(searchText);
		reservationtable.columns(1).search(station);
		reservationtable.columns(2).search(from);
		reservationtable.columns(3).search(to);

		reservationtable.draw();
	}
</script>
