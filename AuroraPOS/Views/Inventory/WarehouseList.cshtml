@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="/vendor/js/jquery.dataTables.min.js"></script>
<script scr="http://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.0.2/js/toastr.min.js">
</script>
<div class="page-header">
    <div class="page-title">
        <h4>@ViewLocalizer["Warehouse List"]</h4>
        <h6>@ViewLocalizer["Manage your Warehouse"]</h6>
    </div>
    <div class="page-btn">
        <a id="add-warehouse" href="javascript:void(0);" class="btn btn-added"><img src="~/vendor/img/icons/plus.svg" alt="img" class="me-2">@ViewLocalizer["Add Warehouse"]</a>
    </div>
</div>


<!-- /product list -->
<div class="card">
    <div class="card-body">
        <div class="row">
            <div class="table-top">
                <div class="search-set">
                    <div class="search-path">
                        <a class="btn btn-filter" id="filter_search">
                            <img src="/vendor/img/icons/filter.svg" alt="img">
                            <span><img src="/vendor/img/icons/closes.svg" alt="img"></span>
                        </a>
                    </div>
                    <div class="search-input">
                        <a class="btn btn-searchset"><img src="/vendor/img/icons/search-white.svg" alt="img"></a>
                        <div class="dataTables_filter"><label> <input id="filter-searchtext" type="search" class="form-control form-control-sm" placeholder="@ViewLocalizer["Search"]" ..."></label></div>
                    </div>
                </div>
                <div class="wordset">
                    <ul>
                        <li>
                            <a data-bs-toggle="tooltip" data-bs-placement="top" title="pdf"><img src="/vendor/img/icons/pdf.svg" alt="img"></a>
                        </li>
                        <li>
                            <a data-bs-toggle="tooltip" data-bs-placement="top" title="excel"><img src="/vendor/img/icons/excel.svg" alt="img"></a>
                        </li>
                        <li>
                            <a data-bs-toggle="tooltip" data-bs-placement="top" title="print"><img src="/vendor/img/icons/printer.svg" alt="img"></a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /Filter -->
            <div class="card" id="filter_inputs">
                <div class="card-body pb-0">
                    <div class="row">
                        <div class="col-lg-4 col-sm-6 col-12">
                            <div class="form-group">
                                <label>@ViewLocalizer["Status"] </label>
                                <select id="filter-status" class="select">
                                    <option value="1" selected>@ViewLocalizer["Active"]</option>
                                    <option value="0">@ViewLocalizer["Inactive"]</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="table-responsive">
                <table id="warehouse-list" class="table">
                    <thead>
                        <tr>
                            <th>@ViewLocalizer["Action"]</th>
                            <th>@ViewLocalizer["Warehouse name"] </th>
                            <th>@ViewLocalizer["Email"]</th>
                            <th>@ViewLocalizer["Phone"]</th>
                            <th>@ViewLocalizer["Status"]</th>
                            
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- /product list -->
<!-- edit Modal -->
<div class="modal fade" id="editwarehouse" tabindex="-1" role="dialog" aria-hidden="true" data-id="">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="warehouse-modal-title">@ViewLocalizer["Edit Warehouse"]</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">

                    <div class="col-12">
                        <div class="form-group">
                            <label>@ViewLocalizer["Warehouse name"]<span class="manitory">*</span></label>
                            <input id="ew-name" type="text">
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label>@ViewLocalizer["Email"]<span class="manitory">*</span></label>
                            <input id="ew-email" type="text">
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label>@ViewLocalizer["Phone"]<span class="manitory">*</span></label>
                            <input id="ew-phone" type="text">
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group mb-0">
                            <label>@ViewLocalizer["Status"]</label>
                            <select id="ew-status" class="select">
                                <option value="">@ViewLocalizer["Choose Status"]</option>
                                <option value="1"> @ViewLocalizer["Active"]</option>
                                <option value="0"> @ViewLocalizer["InActive"]</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="edit-warehouse" type="button" class="btn btn-submit">@ViewLocalizer["Update"]</button>
                <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">@ViewLocalizer["Cancel"]</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
      

        $("#filter-searchtext").on("change keyup", function () {
            FilterWarehouse()
        });
        $("#filter-status").on("change", function () {
            FilterWarehouse()
        });

       
    });


    var warehousetable = $("#warehouse-list").DataTable({
        "processing": true, // for show progress bar
        "serverSide": true, // for process server side
        "dom": 'rt<"row"<"col-sm-3"l><"col-sm-6 s-txt"p><"col-sm-3 text-end"i>>',
        "orderMulti": false, // for disable multiple column at once
        "ajax": {
            "url": "/Inventory/GetWarehouseList",
            "type": "POST",
            "datatype": "json"
        },
        'select': {
            'style': 'multi'
        },
        "pageLength": 10,
        "lengthMenu": [10, 25, 50],
        "order": [[1, 'asc']],
        "columns": [
            {
            'data': 'action', 'name': 'action',
            render: function (data, type, row) {
                return "<a class='me-3' href='javascript:void(0);' onclick='EditWarehouse(" + JSON.stringify(row) + ")'><img src='/vendor/img/icons/edit.svg' alt='img'></a>";
            },
        },
            { "data": "warehouseName", "name": "warehouseName", "autoWidth": true },
            { "data": "email", "name": "email", "autoWidth": true },
            { "data": "phoneNumber", "name": "phoneNumber", "autoWidth": true },
            {
                'data': 'status', 'name': 'isActive',
                render: function (data, type, row) {
                    if (row.isActive) {
                        return "<span class='badges bg-lightgreen'>@ViewLocalizer["Active"]</span>";
                    }
                    else {
                        return "<span class='badges bg-lightred'>@ViewLocalizer["InActive"]</span>";
                    }
                },
                "autoWidth": true
            },
            
        ]
    });


    $("#add-warehouse").click(function () {

        $("#ew-name").val("");

        $("#ew-email").val("");
        $("#ew-phone").val("");
       
            $("#ew-status").val("1").change();
       
       
        $(".warehouse-modal-title").html("@ViewLocalizer["Add Warehouse"]");
        $("#editwarehouse").data("id", 0);
        $("#editwarehouse").modal("show");
    });

    function EditWarehouse(w) {
        $("#ew-name").val(w.warehouseName);

        $("#ew-email").val(w.email);
        $("#ew-phone").val(w.phoneNumber);
        if (w.isActive) {
            $("#ew-status").val("1").change();
        }
        else {
            $("#ew-status").val("0").change();
        }
        $(".warehouse-modal-title").html("@ViewLocalizer["Edit Warehouse"]");
        $("#editwarehouse").data("id", w.id);
        $("#editwarehouse").modal("show");
    }
  
    $("#edit-warehouse").click(function () {

        var warehouseName = $("#ew-name").val();
        var email = $("#ew-email").val();
        var phone = $("#ew-phone").val();

        if (!warehouseName || !email || !phone) {
            toastr.warning("@ViewLocalizer["Please fill in the inputs."]", { showMethod: "fadeIn", hideMethod: "fadeOut", timeOut: 2e3 })
            return;
        }

        var active = $("#ew-status").val()
        var data = {
            ID: $("#editwarehouse").data("id"),
            WarehouseName: warehouseName,
            Email: email,
            PhoneNumber: phone,
            IsActive: active == "1"
        }

        $.ajax({
            url: "/Inventory/EditWarehouse",
            type: "POST",
            data: data,
            success: function (data, textStatus, jqXHR) {
                if (data.status == 0) {
                    warehousetable.draw();
                    $("#editwarehouse").modal("hide");
                }
                else {
                    toastr.error("@ViewLocalizer["Failed to update the warehouse."]", {})
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                toastr.error("@ViewLocalizer["There was an error to process the request."]", {})
            }
        });
    });

    function DeleteWarehouse(id) {

        Swal.fire({
            title: "@ViewLocalizer["Are you sure to delete the warehouse item?"]",
            text: "",
            type: "warning",
            showCancelButton: !0,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "@ViewLocalizer["Yes, delete it!"]",
            confirmButtonClass: "btn btn-primary",
            cancelButtonText: "@ViewLocalizer["Close"]",
            cancelButtonClass: "btn btn-danger ml-1",
            buttonsStyling: !1,
        }).then(function (t) {
            if (t.value) {
                $.ajax({
                    url: "/Inventory/DeleteWarehouse?warehouseId=" + id,
                    type: "POST",
                    success: function (data, textStatus, jqXHR) {
                        if (data.status == 0) {
                            warehousetable.draw();
                        }
                        else {
                            toastr.error("@ViewLocalizer["Failed to delete the warehouse."]", {})
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        toastr.error("@ViewLocalizer["There was an error to process the request."]", {})
                    }
                });
            }
        });
    }

    function FilterWarehouse()
    {
        var searchText = $("#filter-searchtext").val();
        var status = $("#filter-status").val();
        
        warehousetable.columns(0).search(searchText);
        warehousetable.columns(1).search(status);

        warehousetable.draw();
    }


</script>
